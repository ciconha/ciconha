name: Guild Card - ciconha

on:
  schedule:
    - cron: '0 12 * * *'
  workflow_dispatch:
  push:
    branches: [ main, master ]
    paths:
      - '.github/workflows/guild.yml'

permissions:
  contents: write

jobs:
  generate-guild-card:
    runs-on: ubuntu-latest
    name: Generate RPG Guild Card
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup environment
        run: |
          sudo apt-get update
          sudo apt-get install -y curl jq



      - name: Generate Guild Card SVG
        env:
          GITHUB_USERNAME: "ciconha"
          CARD_STYLE: "fantasy"
          CARD_SIZE: "small"
          CARD_LAYOUT: "card"
          USER_CLASS: "⚙️ Mestre Backend"
          USER_AREA: "backend"
          USER_AGE: "20"
          USER_COMPANY: "INSS"
          INCLUDE_STATS: "minimal"
          LANGUAGE: "pt"
        run: |
          echo "🎮 Iniciando geração do Guild Card para: $GITHUB_USERNAME"
          
          # Criar diretório para os cartões
          mkdir -p guild-cards
          
          # Buscar dados do GitHub
          echo "📡 Buscando dados do GitHub..."
          USER_DATA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/users/$GITHUB_USERNAME")
          
          # Buscar repositórios
          REPOS_DATA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/users/$GITHUB_USERNAME/repos?sort=updated&per_page=100")
          
          # Buscar eventos para atividades
          EVENTS_DATA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/users/$GITHUB_USERNAME/events?per_page=100")
          
          # Processar dados e gerar SVG
          echo "🎨 Gerando cartão SVG..."
          
          # Aqui você pode adicionar a lógica completa de geração do SVG
          # baseada nos dados coletados e nas configurações
          
          # Exemplo básico de SVG
          cat > guild-cards/$GITHUB_USERNAME.svg << EOF
          <svg xmlns="http://www.w3.org/2000/svg" width="300" height="400" viewBox="0 0 300 400">
            <defs>
              <style>
                .title { font: bold 20px sans-serif; fill: #fff; }
                .text { font: 14px sans-serif; fill: #ccc; }
              </style>
              <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#1a1a2e"/>
                <stop offset="100%" stop-color="#16213e"/>
              </linearGradient>
            </defs>
            
            <rect width="100%" height="100%" fill="url(#bg)" rx="15"/>
            
            <text x="50%" y="50" text-anchor="middle" class="title">🛡️ Guild Card</text>
            <text x="50%" y="80" text-anchor="middle" class="text">@$GITHUB_USERNAME</text>
            <text x="50%" y="110" text-anchor="middle" class="text">⚙️ Mestre Backend</text>
            <text x="50%" y="140" text-anchor="middle" class="text">🏢 INSS</text>
            <text x="50%" y="170" text-anchor="middle" class="text">🎯 backend</text>
            <text x="50%" y="230" text-anchor="middle" class="text">Gerado em $(date +'%d/%m/%Y')</text>
          </svg>
          EOF
          
          echo "✅ Cartão gerado com sucesso!"

      - name: Commit and Push Card
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            git add guild-cards/
            git commit -m "🎮 Atualizar Guild Card de ciconha - $(date +'%d/%m/%Y %H:%M')"
            git push
            echo "🚀 Cartão commitado e enviado!"
          else
            echo "📝 Nenhuma alteração para commit"
          fi

      - name: Upload Card as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: guild-card-${{ github.sha }}
          path: guild-cards/
          retention-days: 30

      - name: Notify Success
        if: success()
        run: |
          echo "🎉 Guild Card gerado com sucesso!"
          echo "📊 Estilo: fantasy"
          echo "📐 Tamanho: small"
          echo "👤 Usuário: ciconha"

  deploy-to-pages:
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    needs: generate-guild-card
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
        with:
          artifact_name: guild-card-${{ github.sha }}

# Configurações do workflow:
# • Usuário: ciconha
# • Estilo: fantasy
# • Tamanho: small
# • Layout: card
# • Classe: ⚙️ Mestre Backend
# • Atualização: daily
# • Idioma: pt
# • Estatísticas: minimal

# ⚠️ IMPORTANTE:
# 1. Este arquivo deve ser salvo como .github/workflows/guild.yml
# 2. Configure o GITHUB_TOKEN nas secrets do repositório
# 3. Para token personalizado, adicione como secret: GH_PAT
# 4. O cartão será gerado na pasta 'guild-cards/'
