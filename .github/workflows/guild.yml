name: Guild Card SVG

on:
  workflow_dispatch:
    inputs:
      usuario:
        description: 'Nome de usuário do GitHub'
        required: true
        default: 'ciconha'

permissions:
  contents: write

jobs:
  gerar-svg:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4

      - name: Instalar dependências
        run: sudo apt-get install curl jq

      - name: Buscar dados do GitHub
        id: dados
        run: |
          curl -s https://api.github.com/users/${{ github.event.inputs.usuario }} > user.json
          echo "login=$(jq -r .login user.json)" >> $GITHUB_OUTPUT
          echo "avatar=$(jq -r .avatar_url user.json)" >> $GITHUB_OUTPUT
          echo "repos=$(jq -r .public_repos user.json)" >> $GITHUB_OUTPUT
          echo "followers=$(jq -r .followers user.json)" >> $GITHUB_OUTPUT

      - name: Gerar SVG do cartão
        run: |
          mkdir -p cards
          echo "<svg xmlns='http://www.w3.org/2000/svg' width='400' height='200'>
            <style>
              .title { font: bold 20px serif; fill: #3b2f2f; }
              .text { font: 14px serif; fill: #3b2f2f; }
              .bg { fill: #fdf6e3; }
              .border { stroke: #8b5e3c; stroke-width: 4; fill: none; }
            </style>
            <rect class='bg' width='100%' height='100%' />
            <rect class='border' x='2' y='2' width='396' height='196' />
            <image href='${{ steps.dados.outputs.avatar }}' x='20' y='20' width='60' height='60' />
            <text x='100' y='40' class='title'>${{ steps.dados.outputs.login }}</text>
            <text x='100' y='70' class='text'>Classe: Feiticeiro</text>
            <text x='100' y='90' class='text'>Nível: $(( ${{ steps.dados.outputs.repos }} + ${{ steps.dados.outputs.followers }} ))</text>
          </svg>" > cards/${{ github.event.inputs.usuario }}.svg

      - name: Commit e Push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add cards/
          git commit -m "Cartão SVG da guilda gerado para ${{ github.event.inputs.usuario }}"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
