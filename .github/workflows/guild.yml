name: Guild Card - ciconha

on:
  schedule:
    - cron: '0 12 * * *'
  workflow_dispatch:
  push:
    branches: [ main, master ]
    paths:
      - '.github/workflows/guild.yml'

permissions:
  contents: write

jobs:
  generate-guild-card:
    runs-on: ubuntu-latest
    name: Generate RPG Guild Card
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup environment
        run: |
          sudo apt-get update
          sudo apt-get install -y curl jq



      - name: Generate Guild Card SVG
        env:
          GITHUB_USERNAME: "ciconha"
          CARD_STYLE: "fantasy"
          CARD_SIZE: "small"
          CARD_LAYOUT: "card"
          USER_CLASS: "âš™ï¸ Mestre Backend"
          USER_AREA: "backend"
          USER_AGE: "20"
          USER_COMPANY: "INSS"
          INCLUDE_STATS: "minimal"
          LANGUAGE: "pt"
        run: |
          echo "ğŸ® Iniciando geraÃ§Ã£o do Guild Card para: $GITHUB_USERNAME"
          
          # Criar diretÃ³rio para os cartÃµes
          mkdir -p guild-cards
          
          # Buscar dados do GitHub
          echo "ğŸ“¡ Buscando dados do GitHub..."
          USER_DATA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/users/$GITHUB_USERNAME")
          
          # Buscar repositÃ³rios
          REPOS_DATA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/users/$GITHUB_USERNAME/repos?sort=updated&per_page=100")
          
          # Buscar eventos para atividades
          EVENTS_DATA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/users/$GITHUB_USERNAME/events?per_page=100")
          
          # Processar dados e gerar SVG
          echo "ğŸ¨ Gerando cartÃ£o SVG..."
          
          # Aqui vocÃª pode adicionar a lÃ³gica completa de geraÃ§Ã£o do SVG
          # baseada nos dados coletados e nas configuraÃ§Ãµes
          
          # Exemplo bÃ¡sico de SVG
          cat > guild-cards/$GITHUB_USERNAME.svg << EOF
          <svg xmlns="http://www.w3.org/2000/svg" width="300" height="400" viewBox="0 0 300 400">
            <defs>
              <style>
                .title { font: bold 20px sans-serif; fill: #fff; }
                .text { font: 14px sans-serif; fill: #ccc; }
              </style>
              <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#1a1a2e"/>
                <stop offset="100%" stop-color="#16213e"/>
              </linearGradient>
            </defs>
            
            <rect width="100%" height="100%" fill="url(#bg)" rx="15"/>
            
            <text x="50%" y="50" text-anchor="middle" class="title">ğŸ›¡ï¸ Guild Card</text>
            <text x="50%" y="80" text-anchor="middle" class="text">@$GITHUB_USERNAME</text>
            <text x="50%" y="110" text-anchor="middle" class="text">âš™ï¸ Mestre Backend</text>
            <text x="50%" y="140" text-anchor="middle" class="text">ğŸ¢ INSS</text>
            <text x="50%" y="170" text-anchor="middle" class="text">ğŸ¯ backend</text>
            <text x="50%" y="230" text-anchor="middle" class="text">Gerado em $(date +'%d/%m/%Y')</text>
          </svg>
          EOF
          
          echo "âœ… CartÃ£o gerado com sucesso!"

      - name: Commit and Push Card
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            git add guild-cards/
            git commit -m "ğŸ® Atualizar Guild Card de ciconha - $(date +'%d/%m/%Y %H:%M')"
            git push
            echo "ğŸš€ CartÃ£o commitado e enviado!"
          else
            echo "ğŸ“ Nenhuma alteraÃ§Ã£o para commit"
          fi

      - name: Upload Card as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: guild-card-${{ github.sha }}
          path: guild-cards/
          retention-days: 30

      - name: Notify Success
        if: success()
        run: |
          echo "ğŸ‰ Guild Card gerado com sucesso!"
          echo "ğŸ“Š Estilo: fantasy"
          echo "ğŸ“ Tamanho: small"
          echo "ğŸ‘¤ UsuÃ¡rio: ciconha"

  deploy-to-pages:
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    needs: generate-guild-card
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
        with:
          artifact_name: guild-card-${{ github.sha }}

# ConfiguraÃ§Ãµes do workflow:
# â€¢ UsuÃ¡rio: ciconha
# â€¢ Estilo: fantasy
# â€¢ Tamanho: small
# â€¢ Layout: card
# â€¢ Classe: âš™ï¸ Mestre Backend
# â€¢ AtualizaÃ§Ã£o: daily
# â€¢ Idioma: pt
# â€¢ EstatÃ­sticas: minimal

# âš ï¸ IMPORTANTE:
# 1. Este arquivo deve ser salvo como .github/workflows/guild.yml
# 2. Configure o GITHUB_TOKEN nas secrets do repositÃ³rio
# 3. Para token personalizado, adicione como secret: GH_PAT
# 4. O cartÃ£o serÃ¡ gerado na pasta 'guild-cards/'
