name: Guild Card Generator

on:
  workflow_dispatch:
    inputs:
      usuario:
        description: "Usu√°rio GitHub"
        required: true
        default: "ciconha"
  schedule:
    - cron: '0 0 * * 0'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Run generator script
        env:
          USERNAME: ${{ github.event.inputs.usuario }}
          CARD_STYLE: "medieval"
          CARD_SIZE: "medium"
          LAYOUT: "banner"
          AREA: "backend"
          EMPRESA: "INSS"
          IDADE: "20"
          INCLUDE_STATS: "basic"
          LANGUAGE: "pt"
          PERSONAL_TOKEN: ${{ secrets.PERSONAL_TOKEN || '' }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # garante que Node esteja pronto
          node --version
          # roda o script que est√° em .github/scripts/generateCard.js
          node .github/scripts/generateCard.js

      - name: Commit & Push (se permitido)
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add cards/ || true
          git commit -m "ü§ñ Atualiza Guild Card: ${{ github.event.inputs.usuario }}" || echo "Nada para commitar"
          git push || echo "Push falhou - sem permiss√£o"
