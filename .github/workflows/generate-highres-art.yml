name: Generate Highres Cyber Art - Japan Nisos

on:
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/generate-highres-art.yml'

jobs:
  generate-art:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Pillow
        run: python -m pip install --upgrade pip && pip install pillow

      - name: Create scripts and output dirs
        run: mkdir -p scripts output japan_nisos

      - name: Write highres generator script
        run: |
          cat > scripts/generate_highres_cyber_single.py << 'PY'
          #!/usr/bin/env python3
          """
          Gera uma única imagem PNG estilizada (fundo transparente) no diretório japan_nisos.
          Uso: python scripts/generate_highres_cyber_single.py japan_nisos/secret_dark_zone.png 2
          Onde o último argumento é scale (1=100%, 2=200%, etc).
          """
          import sys, random
          from PIL import Image, ImageDraw, ImageFont, ImageFilter

          def draw_single_folder(draw, x, y, w, h, title, subtitle, right_label, vertical_text, palette):
              bg = palette['bg']
              accent = palette['accent']
              text = palette['text']
              detail = palette['detail']

              pad = max(8, w//60)
              # main rounded rectangle (folder body)
              radius = max(6, w//60)
              left, top, right, bottom = x, y, x+w, y+h
              draw.rounded_rectangle([left, top, right, bottom], radius=radius, fill=bg, outline=detail, width=max(1, w//200))

              # tab (top-left)
              tab_w = int(w*0.36)
              tab_h = int(h*0.14)
              tab_x = x + pad
              tab_y = y - tab_h + pad//2
              draw.rectangle([tab_x, tab_y, tab_x + tab_w, tab_y + tab_h], fill=accent, outline=detail)

              # top accent stripe
              stripe_h = int(h*0.07)
              draw.rectangle([x, y, x+w, y+stripe_h], fill=accent)

              # title & subtitle
              try:
                  font_title = ImageFont.truetype("DejaVuSans-Bold.ttf", size=max(18, int(h*0.10)))
                  font_sub = ImageFont.truetype("DejaVuSans.ttf", size=max(12, int(h*0.055)))
                  font_label = ImageFont.truetype("DejaVuSans-Bold.ttf", size=max(14, int(h*0.065)))
                  font_vert = ImageFont.truetype("DejaVuSans.ttf", size=max(14, int(h*0.05)))
              except Exception:
                  font_title = ImageFont.load_default()
                  font_sub = ImageFont.load_default()
                  font_label = ImageFont.load_default()
                  font_vert = ImageFont.load_default()

              tx = x + int(w*0.08)
              ty = y + int(h*0.12)
              draw.text((tx, ty), title, fill=text, font=font_title)
              draw.text((tx, ty + int(h*0.12)), subtitle, fill=detail, font=font_sub)

              # right-side label box
              lbl_w = int(w*0.14)
              lbl_h = int(h*0.12)
              lx = x + w - lbl_w - pad
              ly = y + stripe_h + pad
              draw.rectangle([lx, ly, lx + lbl_w, ly + lbl_h], fill=accent, outline=detail)
              draw.text((lx + 6, ly + 6), right_label, fill=text, font=font_label)

              # vertical text on right edge (rotated)
              vert_txt = vertical_text
              vt_font = font_vert
              # create rotated text image
              vt_w, vt_h = vt_font.getsize(vert_txt)
              vt_img = Image.new("RGBA", (vt_w+8, vt_h+8), (0,0,0,0))
              vdraw = ImageDraw.Draw(vt_img)
              vdraw.text((4,4), vert_txt, fill=accent, font=vt_font)
              vt_img = vt_img.rotate(90, expand=1)
              # paste near right edge
              vtx = x + w - int(w*0.02) - vt_img.width
              vty = y + int(h*0.30)
              img.paste(vt_img, (vtx, vty), vt_img)

              # barcode-like pattern bottom-right
              bx = x + w - int(w*0.30)
              by = y + int(h*0.56)
              for i in range(12):
                  bw = random.randint(max(2, w//240), max(6, w//120))
                  bh = int(h*0.18) + random.randint(-h//80, h//80)
                  draw.rectangle([bx + i*(bw+2), by, bx + i*(bw+2) + bw, by + bh], fill=detail)

              # fingerprint-ish circle detail bottom-left
              cx = x + int(w*0.18)
              cy = y + int(h*0.72)
              cr = int(min(w,h)*0.08)
              for i in range(6):
                  draw.ellipse([cx-cr+i*2, cy-cr+i*2, cx+cr-i*2, cy+cr-i*2], outline=detail, width=max(1, w//250))

              # small meta text bottom
              meta_x = x + int(w*0.06)
              meta_y = y + int(h*0.88)
              meta_txt = "/72.882.0/ (03.27.25 / 3.05)"
              draw.text((meta_x, meta_y), meta_txt, fill=detail, font=font_sub)

              # glitches and lines
              for i in range(max(12, w//60)):
                  gx = x + random.randint(0, w)
                  gy = y + random.randint(int(h*0.08), int(h*0.85))
                  gw = random.randint(max(6,w//160), max(40,w//50))
                  draw.line([gx, gy, gx+gw, gy], fill=accent, width=max(1,w//300))

          def main():
              out_path = sys.argv[1] if len(sys.argv) > 1 else "japan_nisos/secret_dark_zone.png"
              scale = int(sys.argv[2]) if len(sys.argv) > 2 else 2
              base_W, base_H = 800, 1200   # portrait-style single folder
              W, H = base_W * scale, base_H * scale

              global img
              img = Image.new("RGBA", (W, H), (0,0,0,0))  # transparent background
              draw = ImageDraw.Draw(img)

              # subtle noise/grid
              for i in range(0, W, max(6, scale*6)):
                  draw.line([(i,0),(i,H)], fill=(255,255,255,6))
              for j in range(0, H, max(6, scale*6)):
                  draw.line([(0,j),(W,j)], fill=(255,255,255,5))

              # palette inspired by the examples
              palette = {'bg': (14,14,18,255), 'accent': (220,30,35,255), 'text': (245,245,246,255), 'detail': (200,60,60,255)}

              title = "SECRET DARK ZONE."
              subtitle = "RD-E // @NIN NETWORK"
              right_label = "R1000"
              vertical_text = "KSPADENGENOMIN19"

              # folder dimensions and padding
              pad = int(60 * scale)
              x = pad
              y = pad
              w = W - pad*2
              h = H - pad*2

              draw_single_folder(draw, x, y, w, h, title, subtitle, right_label, vertical_text, palette)

              # final polish: tiny gaussian blur (0 or 1), optional sharpening
              img = img.filter(ImageFilter.GaussianBlur(radius=0))
              img.save(out_path, "PNG")
              print("Saved:", out_path)

          if __name__ == '__main__':
              main()
          PY

      - name: Run generator (200% scale) and create japan_nisos image
        run: |
          python scripts/generate_highres_cyber_single.py japan_nisos/secret_dark_zone.png 2

      - name: List japan_nisos folder
        run: ls -la japan_nisos || true

      - name: Upload generated image
        uses: actions/upload-artifact@v4
        with:
          name: japan-nisos-image
          path: japan_nisos/secret_dark_zone.png
